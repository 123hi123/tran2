# åºåˆ—è³‡æ–™æº–å‚™è©³è§£ - prepare_sequences å‡½æ•¸

## ğŸ¯ å‡½æ•¸ç›®çš„
`prepare_sequences` å‡½æ•¸çš„ä¸»è¦ç›®çš„æ˜¯å°‡CSVæ ¼å¼çš„æ‰‹èªè³‡æ–™è½‰æ›æˆé©åˆGRUæ¨¡å‹è¨“ç·´çš„æ™‚åºåºåˆ—æ ¼å¼ã€‚

## ğŸ“Š è³‡æ–™è½‰æ›éç¨‹

### åŸå§‹è³‡æ–™æ ¼å¼
```
CSVè³‡æ–™ï¼ˆæ¯è¡Œæ˜¯ä¸€å¹€ï¼‰:
frame  pose_tag11_x  pose_tag11_y  ...  sign_language  sign_language_encoded
1      0.234         0.567         ...  hello          0
2      0.235         0.568         ...  hello          0
3      0.236         0.569         ...  hello          0
...
50     0.240         0.570         ...  hello          0
```

### ç›®æ¨™åºåˆ—æ ¼å¼
```
3Då¼µé‡ [æ¨£æœ¬æ•¸, åºåˆ—é•·åº¦, ç‰¹å¾µç¶­åº¦]:
sequences[0] = [
    [frame1çš„æ‰€æœ‰ç‰¹å¾µ],  # ç¬¬1å¹€
    [frame2çš„æ‰€æœ‰ç‰¹å¾µ],  # ç¬¬2å¹€
    ...
    [frame20çš„æ‰€æœ‰ç‰¹å¾µ]  # ç¬¬20å¹€
]
labels[0] = 0  # å°æ‡‰çš„é¡åˆ¥æ¨™ç±¤
```

## ğŸ”„ è©³ç´°è™•ç†æ­¥é©Ÿ

### æ­¥é©Ÿ1: æå–ç‰¹å¾µæ¬„ä½
```python
feature_cols = [col for col in data.columns 
               if col not in ['sign_language', 'sign_language_encoded']]
```
**ä½œç”¨**: ç§»é™¤æ¨™ç±¤æ¬„ä½ï¼Œåªä¿ç•™å¯¦éš›çš„ç‰¹å¾µæ•¸æ“šï¼ˆåº§æ¨™é»ç­‰ï¼‰

### æ­¥é©Ÿ2: æŒ‰é¡åˆ¥åˆ†çµ„è™•ç†
```python
for sign_language in data['sign_language'].unique():
    class_data = data[data['sign_language'] == sign_language]
```
**ä½œç”¨**: å°‡ç›¸åŒæ‰‹èªé¡åˆ¥çš„æ‰€æœ‰å¹€æ•¸æ“šé›†ä¸­è™•ç†

### æ­¥é©Ÿ3: å‰µå»ºæ™‚åºåºåˆ—
æœ‰å…©ç¨®æƒ…æ³ï¼š

#### æƒ…æ³A: è³‡æ–™å……è¶³ï¼ˆâ‰¥ sequence_lengthå¹€ï¼‰
```python
if len(class_data) >= sequence_length:
    for i in range(len(class_data) - sequence_length + 1):
        seq = class_data.iloc[i:i+sequence_length][feature_cols].values
        sequences.append(seq)
```

**æ»‘å‹•çª—å£ç¤ºä¾‹** (sequence_length=5):
```
åŸå§‹50å¹€ â†’ å‰µå»º46å€‹åºåˆ—:
åºåˆ—1: [å¹€1, å¹€2, å¹€3, å¹€4, å¹€5]
åºåˆ—2: [å¹€2, å¹€3, å¹€4, å¹€5, å¹€6]
åºåˆ—3: [å¹€3, å¹€4, å¹€5, å¹€6, å¹€7]
...
åºåˆ—46: [å¹€46, å¹€47, å¹€48, å¹€49, å¹€50]
```

#### æƒ…æ³B: è³‡æ–™ä¸è¶³ï¼ˆ< sequence_lengthå¹€ï¼‰
```python
else:
    # é‡è¤‡æœ€å¾Œä¸€å¹€ä¾†å¡«å……
    padding_needed = sequence_length - len(seq_data)
    last_frame = seq_data[-1:]
    padding = np.repeat(last_frame, padding_needed, axis=0)
    seq_data = np.vstack([seq_data, padding])
```

**å¡«å……ç¤ºä¾‹** (åªæœ‰3å¹€ï¼Œéœ€è¦5å¹€):
```
åŸå§‹: [å¹€1, å¹€2, å¹€3]
å¡«å……å¾Œ: [å¹€1, å¹€2, å¹€3, å¹€3, å¹€3]  # é‡è¤‡æœ€å¾Œä¸€å¹€
```

## ğŸ§® è¼¸å‡ºçµæœ

### æœ€çµ‚å¼µé‡å½¢ç‹€
- **sequences**: `(æ¨£æœ¬æ•¸, sequence_length, ç‰¹å¾µç¶­åº¦)`
- **labels**: `(æ¨£æœ¬æ•¸,)`

### å¯¦éš›ä¾‹å­
å‡è¨­æœ‰ï¼š
- 3å€‹æ‰‹èªé¡åˆ¥ (hello, thanks, goodbye)
- æ¯å€‹é¡åˆ¥50å¹€è³‡æ–™
- sequence_length=20
- ç‰¹å¾µç¶­åº¦=163

çµæœï¼š
```python
sequences.shape = (138, 20, 163)
# 138 = æ¯é¡46å€‹åºåˆ— Ã— 3é¡ = 138å€‹è¨“ç·´æ¨£æœ¬
# 20 = åºåˆ—é•·åº¦ï¼ˆæ™‚é–“æ­¥ï¼‰
# 163 = ç‰¹å¾µç¶­åº¦

labels.shape = (138,)
# 138å€‹å°æ‡‰çš„æ¨™ç±¤
```

## âš¡ ç‚ºä»€éº¼éœ€è¦é€™æ¨£è™•ç†ï¼Ÿ

### 1. **æ™‚åºå»ºæ¨¡éœ€æ±‚**
- GRU/LSTMéœ€è¦å›ºå®šé•·åº¦çš„åºåˆ—è¼¸å…¥
- æ‰‹èªæ˜¯æ™‚åºå‹•ä½œï¼Œéœ€è¦åˆ†æé€£çºŒå¹€ä¹‹é–“çš„é—œä¿‚

### 2. **è³‡æ–™å¢å¼·æ•ˆæœ**
- æ»‘å‹•çª—å£å¢åŠ äº†è¨“ç·´æ¨£æœ¬æ•¸é‡
- å¾50å¹€ç”Ÿæˆ46å€‹è¨“ç·´æ¨£æœ¬ï¼Œå¢å¼·æ¨¡å‹æ³›åŒ–èƒ½åŠ›

### 3. **è™•ç†è®Šé•·åºåˆ—**
- å¯¦éš›æ‰‹èªå‹•ä½œæ™‚é–“é•·çŸ­ä¸ä¸€
- å¡«å……æ©Ÿåˆ¶ç¢ºä¿æ‰€æœ‰åºåˆ—é•·åº¦ä¸€è‡´

## ğŸ” é—œéµåƒæ•¸èªªæ˜

### sequence_length (é è¨­20)
```python
# è¼ƒçŸ­åºåˆ— (10-15): è¨ˆç®—å¿«ï¼Œä½†å¯èƒ½ä¸Ÿå¤±é•·æœŸä¾è³´
# ä¸­ç­‰åºåˆ— (20-30): å¹³è¡¡æ•ˆèƒ½å’Œæ•ˆæœ
# è¼ƒé•·åºåˆ— (40+): æ•æ‰æ›´å¤šæ™‚åºä¿¡æ¯ï¼Œä½†è¨ˆç®—æ˜‚è²´
```

### ç‰¹å¾µç¶­åº¦è¨ˆç®—
```python
# å§¿æ…‹é»: 12é» Ã— 3è»¸ = 36ç¶­ (pose_tag11-22)
# å·¦æ‰‹é»: 21é» Ã— 3è»¸ = 63ç¶­ (Left_hand_tag0-20)  
# å³æ‰‹é»: 21é» Ã— 3è»¸ = 63ç¶­ (Right_hand_tag0-20)
# Frame: 1ç¶­
# ç¸½è¨ˆ: 36 + 63 + 63 + 1 = 163ç¶­
```

## ğŸ’¡ å„ªåŒ–å»ºè­°

### æ ¹æ“šç¡¬é«”èª¿æ•´sequence_length
```python
# RTX A2000 (6GB): sequence_length=20, batch_size=16
# ä½è¨˜æ†¶é«”è¨­å‚™: sequence_length=15, batch_size=8
# é«˜æ•ˆèƒ½è¨­å‚™: sequence_length=30, batch_size=32
```

### è³‡æ–™å“è³ªè€ƒæ…®
- ç¢ºä¿å¹€ä¹‹é–“æ™‚åºé€£çºŒæ€§
- æª¢æŸ¥æ˜¯å¦æœ‰ç¼ºå¤±å¹€æˆ–è·³å¹€
- è€ƒæ…®æ­£è¦åŒ–ç‰¹å¾µæ•¸æ“š

é€™å€‹æ­¥é©Ÿæ˜¯æ•´å€‹æ·±åº¦å­¸ç¿’æµç¨‹ä¸­çš„é—œéµç’°ç¯€ï¼Œå®ƒå°‡åŸå§‹çš„è¡¨æ ¼æ•¸æ“šè½‰æ›æˆç¥ç¶“ç¶²è·¯å¯ä»¥ç†è§£çš„æ™‚åºåºåˆ—æ ¼å¼ï¼
